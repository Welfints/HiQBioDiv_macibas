---
title: "Uzd4_Rubene"
author: "Betija Rubene"
date: "2025-01-18"
output:  rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ceturtais uzdevums - funkcijas, cikli, vienkodola un daudzkodolu skaitļošana

Darbam nepieciešamās pakotnes

```{r, message = FALSE, error = FALSE}
library(tidyverse)
library(terra)
library(sf)
library(sfarrow)
```

Uzdevuma veikšanai nepieciešami Centra virsmežniecības dati, kā arī references rastri 10 un 100 m izšķirtspējā

```{r}
centra_mezi <- st_read_parquet("../centra_mezi/centra_mezi_labots.parquet")
ref10m <- rast(("../ref_rastri/LV10m_10km.tif"))
ref100m <- rast(("../ref_rastri/LV100m_10km.tif"))
```

# 1) Funkcijas izveide

Funkcija secīgi:

 - no piedāvātā MVR faila atlasa mežaudzes, kurās valdošā koku suga ir priede (sugas kods ir “1”);

 - sagatavo tādu rastru 10 m izšķirtspējā visai valsts teritorijai, kurā priežu mežaudzes no iepriekšējā punkta ir apzīmētas ar 1, pārējās Latvijas sauzsemes teritorijā esošās šūnas apzīmētas ar 0 un pārējās šūnas ir NA, un tas atbilst projekta Zenodo repozitorijā ievietotajam references slānim LV10m_10km.tif;

 - iepriekšējā punkta rastru pārveido uz 100 m šūnu, aprēķinot priežu mežaudžu platības īpatsvaru (no kopējās platības) ik 100 m šūnā, nodrošinot atbilstību projekta Zenodo repozitorijā ievietotajam references slānim LV100m_10km.tif;

 - saglabā iepriekšējā punktā izveidoto slāni (ar 100 m izšķirtspēju) kā GeoTIFF failu ar relatīvo ceļu norādītā vietā cietajā diskā, pieņemot ievades faila nosaukumu.
 
 
Ieteiktajos avotos lasīju, ka vieglāk ir sākumā uzrakstīt komandrindas un pēc tam tās savietot strādājošā funkcijā nevis uzreiz censties rakstīt funkciju.

Atlasu, kurās mežaudzēs valdošā suga ir priedes (pēc pirmā stāva pirmās sugas, kolonna s10 = "1")

```{r}
priezu_mezi <- centra_mezi %>% filter(s10 == 1)
```

10 m rastra sagatavošana, kurā priežu mežaudzes no iepriekšējā punkta ir apzīmētas ar 1, pārējās Latvijas sauzsemes teritorijā esošās šūnas apzīmētas ar 0 un pārējās šūnas ir NA atbilstoši references slānim

```{r}
# ref10m_cropped <- crop(ref10m, centra_mezi)
priezu_mezi_10m <- rasterize(priezu_mezi,ref10m)
priezu_mezi_10m <- classify(priezu_mezi_10m, cbind(NA, 0)) 
LAD_lauki_10m[is.na(ref10m)]
plot(priezu_mezi_10m)
```
Iepriekšējā punkta rastru pārveido uz 100 m šūnu, aprēķinot priežu mežaudžu platības īpatsvaru (no kopējās platības) ik 100 m šūnā
 
```{r}
priezu_mezi_100m <- priezu_mezi_10m %>%
    aggregate(fact = 10, fun = sum) %>%
    resample(ref100m, method = "near")
plot(priezu_mezi_100m)
```
 
Saglabā iepriekšējā punktā izveidoto slāni (ar 100 m izšķirtspēju) kā GeoTIFF failu ar relatīvo ceļu norādītā vietā cietajā diskā, pieņemot ievades faila nosaukumu.
 
```{r}
writeRaster(priezu_mezi_100m, "../centra_mezi/priezu_mezi_100m.tif")
```


Tagad tas viss jāsavieto funkcijā...
Funkcijai ir 3 ievades faili - centra_mezi, ref10m un ref100m
 
```{r}
mana_funkcija <- function(x,y,z) {}
```


